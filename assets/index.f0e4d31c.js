var S=Object.defineProperty,T=Object.defineProperties;var E=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var P=(n,e,t)=>e in n?S(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,U=(n,e)=>{for(var t in e||(e={}))N.call(e,t)&&P(n,t,e[t]);if(I)for(var t of I(e))A.call(e,t)&&P(n,t,e[t]);return n},B=(n,e)=>T(n,E(e));import{c as k,o as d,a as p,b as K,t as y,u as f,d as u,n as O,r as m,w,e as $,f as x,g as M,v as G,F as D,h as F,i as V,j as b,k as z,l as q}from"./vendor.caace2b8.js";const H=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}};H();const R="639275188584-8dtf7kiol8rtpotanc9pr14vpq9c34lr.apps.googleusercontent.com",J=281622784083772,W="https://asia-east2-botfat.cloudfunctions.net/project_controller";let v=null;function Z(){v=window.gapi.auth2.getAuthInstance()}async function Q(){var e;let n=(e=v.currentUser.get())==null?void 0:e.getBasicProfile();return new Promise(async(t,o)=>{if(n){let i={id:n.getId(),name:n.getName(),image:n.getImageUrl(),email:n.getEmail()};t(i)}else o(null)})}async function X(){return new Promise(async(n,e)=>{await v.signIn(),n()})}function Y(){return new Promise((n,e)=>{v.disconnect(),v.signOut(),n()})}function ee(){return new Promise((n,e)=>{FB.getLoginStatus(function(t){t.status==="connected"?FB.api("/me",{fields:"id,name,email,picture"},function(o){n({id:o.id,name:o.name,image:o.picture.data.url,email:(o==null?void 0:o.email)||""})}):e(null)})})}function te(){return new Promise((n,e)=>{FB.login(function(t){t.status==="connected"?n():e()})})}function ne(){return new Promise((n,e)=>{FB.api("/me/permissions","DELETE",function(t){FB.logout(),n()})})}function oe(n){let[e,t,o]=n;return[t,e,o]}window.gapi.load("auth2",async()=>{await window.gapi.auth2.init({client_id:R}),Z()});window.fbAsyncInit=function(){FB.init({appId:J,cookie:!0,xfbml:!0,version:"v13.0"}),FB.AppEvents.logPageView()};(function(n,e,t){var o,i=n.getElementsByTagName(e)[0];n.getElementById(t)||(o=n.createElement(e),o.id=t,o.src="https://connect.facebook.net/en_US/sdk.js",i.parentNode.insertBefore(o,i))})(document,"script","facebook-jssdk");var j=(n,e)=>{const t=n.__vccOpts||n;for(const[o,i]of e)t[o]=i;return t};const ie={props:{identity:Object,identityKey:String},emits:["clearUser","setUser"],setup(n,{emit:e}){const t=n,o=k(()=>{var c,g;return!!((g=(c=t.identity)==null?void 0:c.user)==null?void 0:g.id)}),i=k(()=>{var c;return((c=t.identity)==null?void 0:c.icon)||""}),s=()=>{o.value?t.identity.logout().then(()=>e("clearUser",t.identityKey)):t.identity.login().then(()=>e("setUser",t.identityKey))};return(c,g)=>(d(),p("button",{onClick:s},[K(y(f(o)?"\u767B\u51FA":"\u767B\u5165")+" ",1),u("i",{class:O(f(i))},null,2)]))}};var ae=j(ie,[["__scopeId","data-v-7b62d22a"]]);async function se({body:n}){let e=await C({body:n});return e||null}async function re({body:n}){let e=await C({body:n});return e||null}function C({body:n,method:e="POST"}){return fetch(W,{method:e,headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify(n)}).then(t=>t.json()).catch(t=>null)}function le(n=5e3){try{let e;return navigator.geolocation&&(e=new Promise((t,o)=>navigator.geolocation.getCurrentPosition(t,o,{timeout:n})).then(t=>{var o,i;return[((o=t==null?void 0:t.coords)==null?void 0:o.latitude)||0,((i=t==null?void 0:t.coords)==null?void 0:i.longitude)||0]}).catch(t=>null)),e}catch{}}const ce={id:"mapid"},ue={props:{identities:Object,polygonData:Object,placeData:Object},emits:["updateLocation"],setup(n,{emit:e}){const t=n;let o={},i={};const s=m({m:[25.013,121.515]}),c=k(()=>Object.keys(t.identities).map(a=>{var r,l;return(l=(r=t.identities[a])==null?void 0:r.user)==null?void 0:l.image}).filter(a=>a));w(t.identities,()=>{let a=c.value.map(r=>`<img src="${r}" class="tl-img">`).join("");i.bindTooltip("Here you are <br/>"+a)}),w(t.polygonData,()=>{let a=t.polygonData.map.map(r=>r.geometry.coordinates.map(l=>l.map(h=>oe(h))));_(a)}),w(t.placeData,()=>{let{latitude:a,longitude:r,stop_name:l,distance:h}=t.placeData.place;L.popup().setLatLng([a,r]).setContent(`\u5730\u9EDE\uFF1A${l} (${h}m)`).openOn(o)}),$(async()=>{let a=await le();a&&(s.m=a),g()});const g=()=>{o=L.map("mapid",{center:s.m,zoom:15}),o.on("click",r),L.tileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",{maxZoom:17}).addTo(o),i=L.marker(s.m,{draggable:!0,autoPan:!0}).bindTooltip("please login google & facebook first").openTooltip().addTo(o),i.on("moveend",a);function a(l){l.target._latlng&&e("updateLocation",l.target._latlng)}function r(l){i.setLatLng(l.latlng),e("updateLocation",l.latlng)}},_=a=>{L.polygon(a,{color:"red"}).addTo(o)};return(a,r)=>(d(),p("div",ce))}};const de={id:"form",class:"flex between column"},pe={class:"input-area"},ge={class:"flex v-center"},fe={class:"prompt"},_e={class:"list"},me=["onClick"],ye={class:"stop-name"},ve={class:"distance"},he={props:{listData:Object},emits:["emitPlace"],setup(n,{emit:e}){const t=n,o=x(""),i=m({list:[]}),s=k(()=>i.list.length?`\u5171\u6709${i.list.length}\u7B46\u5730\u9EDE`:"\u7121\u641C\u5C0B\u7D50\u679C");w(t.listData,()=>{i.list=t.listData.list});const c=function(_){e("emitPlace",_)},g=function(){i.list=o.value?t.listData.list.filter(_=>_.stop_name.includes(o.value)):t.listData.list};return(_,a)=>(d(),p("div",de,[u("div",pe,[u("div",ge,[M(u("input",{"onUpdate:modelValue":a[0]||(a[0]=r=>o.value=r),placeholder:"\u8ACB\u8F38\u5165\u60A8\u8981\u67E5\u8A62\u7684\u5730\u5740",onInput:g},null,544),[[G,o.value]]),u("i",{class:"icon fas fa-search",onClick:g})]),u("div",fe,y(f(s)),1)]),u("div",_e,[(d(!0),p(D,null,F(f(i).list,(r,l)=>(d(),p("div",{key:l,class:"option flex between",onClick:h=>c(r)},[u("span",ye,y(r.stop_name),1),u("span",ve,y(r.distance)+"m ",1)],8,me))),128))])]))}};var be=j(he,[["__scopeId","data-v-7b0dd506"]]);const we={key:0},ke={key:1},Le={props:{identities:Object},setup(n){const e=x(!0);return(t,o)=>(d(),p("div",{class:O(["information","flex v-center",e.value&&"collapse"])},[u("i",{class:"fas fa-caret-left caret-icon",onClick:o[0]||(o[0]=i=>e.value=!e.value)}),(d(!0),p(D,null,F(n.identities,(i,s)=>{var c;return d(),p("div",{key:s},[((c=i.user)==null?void 0:c.id)?(d(),p("span",we," hi, "+y(i.user.name),1)):(d(),p("span",ke," \u8ACB\u767B\u5165\u60A8\u7684 "+y(s)+" \u5E33\u865F ",1)),V(t.$slots,"default",{identity:i,identityKey:s},void 0,!0)])}),128))],2))}};var xe=j(Le,[["__scopeId","data-v-8a7e0946"]]);const De={class:"infoWrapper"},je={class:"wrapper flex"},Ie={setup(n){const e=m({google:{user:null,icon:"fab fa-google",login:X,logout:Y,getUser:Q},facebook:{user:null,icon:"fab fa-facebook-f",login:te,logout:ne,getUser:ee}}),t=m({map:[]}),o=m({list:[]}),i=m({place:{}});x(!0),$(async()=>{setTimeout(()=>{s("google"),s("facebook")},1500)});const s=function(a){e[a].getUser().then(r=>e[a].user=r).catch(r=>e[a].user=null)},c=function(a){e[a].user=null},g=function(a){if(!e.google.user||!e.google.user){alert("\u8ACB\u5148\u767B\u5165 Google \u8207 Facebook \u5E33\u865F");return}i.place=a},_=async function(a){if(!e.google.user||!e.google.user){alert("\u8ACB\u5148\u767B\u5165 Google \u8207 Facebook \u5E33\u865F");return}let r=await se({body:B(U({},a),{function:"xinbei_distance"})});if((r==null?void 0:r.result)&&(o.list=r.result),!t.map.length){let l=await re({body:{directory:"tucheng.json",function:"xinbei_json"}});l&&(t.map=l.result.features)}};return(a,r)=>(d(),p(D,null,[u("div",De,[b(xe,{identities:f(e)},{default:z(l=>[b(ae,{identity:l.identity,identityKey:l.identityKey,onSetUser:s,onClearUser:c},null,8,["identity","identityKey"])]),_:1},8,["identities"])]),u("div",je,[b(be,{listData:f(o),onEmitPlace:g},null,8,["listData"]),b(ue,{identities:f(e),polygonData:f(t),placeData:f(i),onUpdateLocation:_},null,8,["identities","polygonData","placeData"])])],64))}};q(Ie).mount("#app");
